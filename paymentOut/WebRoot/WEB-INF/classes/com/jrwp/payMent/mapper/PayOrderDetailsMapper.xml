<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jrwp.payMent.dao.PayOrderDetailsMapper">
    <resultMap id="BaseResultMap" type="com.jrwp.payMent.entity.PayOrderDetails">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" property="id" jdbcType="DECIMAL"/>
        <result column="ORDERID" property="orderid" jdbcType="DECIMAL"/>
        <result column="WORKCORDE" property="workcorde" jdbcType="OTHER"/>
        <result column="WORKPROCESSNUMBER" property="workprocessnumber" jdbcType="OTHER"/>
    </resultMap>

    <resultMap id="orderDetail" type="com.jrwp.payMent.entity.PayOrderDetails">
        <id column="OID" property="id" jdbcType="DECIMAL"/>
        <result column="WORKPROCESSNUMBER" property="workprocessnumber" jdbcType="OTHER"/>
        <!-- <result column="ORDERID" property="orderid" jdbcType="DECIMAL" />

         <result column="WORKCORDE" property="workcorde" jdbcType="OTHER" />-->
        <!--映射订单详情-->
        <association property="orderInfo" javaType="com.jrwp.payMent.entity.PayOrders">
            <id column="ID" property="id" jdbcType="DECIMAL"/>
            <result column="USERID" property="userid" jdbcType="DECIMAL"/>
            <result column="MACHINECORE" property="machinecore" jdbcType="OTHER"/>
            <result column="MACHINEIP" property="machineip" jdbcType="OTHER"/>
            <result column="PAYTYPE" property="paytype" jdbcType="DECIMAL"/>
            <result column="PAYSTATUS" property="paystatus" jdbcType="DECIMAL"/>
            <result column="PAYMONEY" property="paymoney" jdbcType="DECIMAL"/>
            <result column="CREATTIME" property="creattime" jdbcType="TIMESTAMP"/>
            <result column="PAYIDFORWX" property="payidforwx" jdbcType="DECIMAL"/>
            <result column="QRCODEURLFORWX" property="qrcodeurlforwx" jdbcType="OTHER"/>
            <result column="PAYIDFORALI" property="payidforali" jdbcType="DECIMAL"/>
            <result column="QRCODEURLFORALI" property="qrcodeurlforali" jdbcType="OTHER"/>
            <result column="RELPAYTYPE" property="relpaytype" jdbcType="DECIMAL"/>
            <result column="ORDERNUMBER" property="ordernumber" jdbcType="OTHER"/>
            <result column="PAYTIME" property="paytime" jdbcType="TIMESTAMP"/>
        </association>
        <!--映射业务详情-->
        <association property="policeClassService" javaType="com.jrwp.payMent.entity.PoliceClassService">
            <result property="serCode" column="SER_CODE" javaType="String" jdbcType="VARCHAR"/>
            <result property="serName" column="SER_NAME" javaType="String" jdbcType="VARCHAR"/>
            <result property="pcCode" column="PC_CODE" javaType="String" jdbcType="VARCHAR"/>
            <result property="price" column="PRICE" javaType="double" jdbcType="NUMERIC"/>

            <!-- 关联查询 -->
            <association property="police" javaType="com.jrwp.payMent.entity.Core_Police">
                <result property="pcCode" column="PC_CODE" javaType="String" jdbcType="VARCHAR"/>
                <result property="pcName" column="PC_NAME" javaType="String" jdbcType="VARCHAR"/>
            </association>
        </association>

    </resultMap>
    <!--数据统计-->
    <select id="getOrderCount"  resultType="com.jrwp.payMent.entity.OrderCount">

       select count(*) as bizCount ,s.ser_name as bizName,max(s.price) as price from  PAY_ORDERDETAILS d
        left join pay_orders o on d.orderid =o.id
        left join policeclass_service s on d.workcorde= s.ser_code
        where o.userid=#{userid}
        <if test="paystatus !=null and paystatus!=''">
            and o.paystatus = #{paystatus}
        </if>
        <if test="begintime !=null and begintime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &gt;= to_date(#{begintime},'yyyy-mm-dd')
        </if>
        <if test="endtime !=null and endtime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &lt;= to_date(#{endtime},'yyyy-mm-dd')
        </if>
         group by s.ser_name
    </select>
    <select id="getOrderCountBydeptid"  resultType="com.jrwp.payMent.entity.OrderCount">

        select count(*) as bizCount ,s.ser_name as bizName,max(s.price) as price from  PAY_ORDERDETAILS d
        left join pay_orders o on d.orderid =o.id
        left join policeclass_service s on d.workcorde= s.ser_code
        left join core_user u on o.userid=u.id
        where u.deptid=#{deptid}
        <if test="paystatus !=null and paystatus!=''">
            and o.paystatus = #{paystatus}
        </if>
        <if test="begintime !=null and begintime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &gt;= to_date(#{begintime},'yyyy-mm-dd')
        </if>
        <if test="endtime !=null and endtime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &lt;= to_date(#{endtime},'yyyy-mm-dd')
        </if>
        group by s.ser_name
    </select>
    <select id="getAllOrderCount"  resultType="com.jrwp.payMent.entity.OrderCount">

        select count(*) as bizCount ,s.ser_name as bizName,max(s.price) as price from  PAY_ORDERDETAILS d
        left join pay_orders o on d.orderid =o.id
        left join policeclass_service s on d.workcorde= s.ser_code
        <if test="paystatus !=null and paystatus!=''">
            and o.paystatus = #{paystatus}
        </if>
        <if test="begintime !=null and begintime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &gt;= to_date(#{begintime},'yyyy-mm-dd')
        </if>
        <if test="endtime !=null and endtime!=''">
            and to_date(to_char(o.paytime,'yyyy-mm-dd'),'yyyy-mm-dd')  &lt;= to_date(#{endtime},'yyyy-mm-dd')
        </if>
        group by s.ser_name
    </select>

    <!--查找订单-->
    <select id="getDetailsById" parameterType="BigDecimal" resultMap="orderDetail">

      select d.id as OID,d.workprocessnumber,o.*,s.*,p.* from PAY_ORDERDETAILS  d
        left join pay_orders o on d.orderid =o.id
        left join policeclass_service s on d.workcorde= s.ser_code
        left join policeclass p on s.pc_code = p.pc_code WHERE D.ID=#{id}
        order by o.creattime DESC
    </select>
    <!--查找订单list-->
    <select id="getDetailsList" resultMap="orderDetail">
         select d.id as OID,d.workprocessnumber,o.*,s.*,p.* from PAY_ORDERDETAILS  d
        left join pay_orders o on d.orderid =o.id
        left join policeclass_service s on d.workcorde= s.ser_code
        left join policeclass p on s.pc_code = p.pc_code
        WHERE o.userid=#{userid}
        order by o.creattime DESC
    </select>
    
    
    <!--查找订单详情-->
 <!--   <select id="getOrderInfo" parameterType="int" resultMap="orderMap">
      select * from PAY_ORDERS o where o.id =#{id}
    </select>-->

    <!--查找业务详情-->
  <!--  <select id="getServiceInfo" parameterType="int" resultMap="policeServiceMap">

          SELECT t.SER_CODE,t.SER_NAME,t.PC_CODE,t.PRICE,t1.pc_name FROM POLICECLASS_SERVICE t
	      LEFT JOIN　policeclass t1 ON t.pc_code = t1.pc_code  where t.ser_code =#{id}
	      ORDER　BY SER_CODE
    </select>-->

    <sql id="Base_Column_List">


        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, ORDERID, WORKCORDE, WORKPROCESSNUMBER
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.math.BigDecimal">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from PAY_ORDERDETAILS
        where ID = #{id,jdbcType=DECIMAL}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.math.BigDecimal">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from PAY_ORDERDETAILS
        where ID = #{id,jdbcType=DECIMAL}
    </delete>
    <insert id="insert" parameterType="com.jrwp.payMent.entity.PayOrderDetails">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into PAY_ORDERDETAILS (ID, ORDERID, WORKCORDE,
        WORKPROCESSNUMBER)
        values (#{id,jdbcType=DECIMAL}, #{orderid,jdbcType=DECIMAL}, #{workcorde,jdbcType=OTHER},
        #{workprocessnumber,jdbcType=OTHER})
    </insert>
    <insert id="insertSelective" parameterType="com.jrwp.payMent.entity.PayOrderDetails">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into PAY_ORDERDETAILS
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="orderid != null">
                ORDERID,
            </if>
            <if test="workcorde != null">
                WORKCORDE,
            </if>
            <if test="workprocessnumber != null">
                WORKPROCESSNUMBER,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=DECIMAL},
            </if>
            <if test="orderid != null">
                #{orderid,jdbcType=DECIMAL},
            </if>
            <if test="workcorde != null">
                #{workcorde,jdbcType=OTHER},
            </if>
            <if test="workprocessnumber != null">
                #{workprocessnumber,jdbcType=OTHER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.jrwp.payMent.entity.PayOrderDetails">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update PAY_ORDERDETAILS
        <set>
            <if test="orderid != null">
                ORDERID = #{orderid,jdbcType=DECIMAL},
            </if>
            <if test="workcorde != null">
                WORKCORDE = #{workcorde,jdbcType=OTHER},
            </if>
            <if test="workprocessnumber != null">
                WORKPROCESSNUMBER = #{workprocessnumber,jdbcType=OTHER},
            </if>
        </set>
        where ID = #{id,jdbcType=DECIMAL}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.jrwp.payMent.entity.PayOrderDetails">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update PAY_ORDERDETAILS
        set ORDERID = #{orderid,jdbcType=DECIMAL},
        WORKCORDE = #{workcorde,jdbcType=OTHER},
        WORKPROCESSNUMBER = #{workprocessnumber,jdbcType=OTHER}
        where ID = #{id,jdbcType=DECIMAL}
    </update>
</mapper>